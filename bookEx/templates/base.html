{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>
        {% block title %}
            Book Exchange
        {% endblock title %}
    </title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="{% static 'main.css' %}" rel="stylesheet" title="text/css">
    <script src="https://kit.fontawesome.com/8df772b06e.js" crossorigin="anonymous"></script>
</head>

<body>
<header>
    {#START OF NAVBAR#}
    <nav class="navbar navbar-expand-md navbar-dark sticky-top align-baseline" style="background-color: #0f3057;">
        {#    LOGO#}
        <a class="navbar-brand" href="{% url 'index' %}"><img src="{% static 'logo-resized.png' %}" width="150"
                                                              height="75" alt=""></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse"
                aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="{% url 'index' %}">Home <span
                            class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Menu</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown01">
                        {% for item in item_list %}
                            <a class="dropdown-item" href="{{ item.link }}"> {{ item.item }} </a>
                        {% endfor %}

                    </div>
                </li>

                <li class="nav-item">
                    {% if user.is_authenticated %}
                        <a class="nav-link" href="{% url 'logout' %}?next=/">Logout</a>
                    {% else %}
                        <a class="nav-link" href="{% url 'login' %}?next=/">Login</a>
                    {% endif %}
                </li>
            </ul>


            {#            START OF CART BUTTON#}
            <a id="cart" role="button" data-html="true" type="button"
               class="btn btn-outline-light mx-3 align-middle"
               data-container="body"
               data-toggle="popover" data-placement="bottom" data-content="Vivamus
sagittis lacus vel augue laoreet rutrum faucibus.">
                {#                <svg width="2em" height="1.6em" viewBox="0 0 16 16" class="bi bi-cart2" fill="currentColor"#}
                {#                     xmlns="http://www.w3.org/2000/svg">#}
                {#                    <path fill-rule="evenodd"#}
                {#                          d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5zM3.14 5l1.25 5h8.22l1.25-5H3.14zM5 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"></path>#}
                {#                </svg>#}
                <i class="fas fa-shopping-cart"></i>
                Cart (<span id="cart-count">0</span>)
                {#                Cart(0)#}
            </a>
            {#            END OF CART BUTTON#}


            <form action="{% url 'search_results' %}" method="get" class="form-inline mt-2 mt-md-0">
                <input name="q" type="text" class="form-control mr-sm-2" placeholder="Search a book.."
                       aria-label="Search">
                <input class="btn btn-outline-success my-2 my-sm-0" type="submit" value="Search">
            </form>


            {% if user.is_authenticated %}
                <span class="badge badge-success"
                      style="margin-left: 1em; margin-right: 1em;">{{ user.username }}</span>
            {% else %}
                <span class="badge badge-secondary mx-auto">Not Logged In </span>
            {% endif %}
        </div>
    </nav>
</header>


<div id="">
    {#    <header id="header">#}
    {#                <div id="logo">#}
    {#                    <img src="{% static 'logo.png' %}" width="150" height="150" alt=""/>#}
    {#                    <span id="top-menu" style="float: right;">#}
    {#                        {% if user.is_authenticated %}#}
    {#                            {{ user.username }}#}
    {#                            <a href="{% url 'logout' %}?next=/"> Logout </a>#}
    {#                        {% else %}#}
    {#                            Login#}
    {#                            <a href="{% url 'login' %}?next=/"> Login </a>#}
    {#                        {% endif %}#}
    {#                    </span>#}
    {#                </div>#}
    {#        <div id="topbanner">#}
    {#            <img src="{% static 'topbanner.jpg' %}" width="800" height="200" alt=""/>#}
    {#        </div>#}
    {#    </header>#}
    <section id="">
        {% block content %}
            Hello
        {% endblock content %}
    </section>
    {#    <aside id="leftsidebar">#}
    {#        <nav id="nav">#}
    {#            <ul>#}
    {#                {% block sidenav %}#}
    {#                    <li>Menu 1</li>#}
    {#                    <li>Menu 2</li>#}
    {#                    <li>Menu 3</li>#}
    {#                {% endblock sidenav %}#}
    {#            </ul>#}
    {#        </nav>#}
    {#    </aside>#}


    {#    <footer class="" id="footer"> CS3337 Django Web System</footer>#}
</div>
<footer class="container-fluid fixed-bottom my-auto py-auto align-text-bottom align-bottom" id="footer">
    <p>&copy; CS3337 Django Web System</p>
</footer>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
</body>
<script type="text/javascript">
    console.log('Cart function working.');

    var cart = localStorage.getItem('cart') == null ? {} : JSON.parse(localStorage.getItem('cart'));
    $(document).on('click', '.atc', function () {
        var item_id = this.id.toString();
        console.log(item_id);

        if (cart[item_id]) {
            quantity = cart[item_id][0] + 1;
            cart[item_id][0] = quantity;
            cart[item_id][2] = cart[item_id][2] + parseFloat(document.getElementById("price" + item_id).innerHTML);
        } else {
            quantity = 1;
            price = parseFloat(document.getElementById("price" + item_id).innerHTML);
            name = document.getElementById("nm" + item_id).innerHTML;
            book_id = item_id
            cart[item_id] = [quantity, name, price, book_id];
        }
        console.log(cart);
        localStorage.setItem('cart', JSON.stringify(cart));
        document.getElementById("cart-count").innerHTML = Object.keys(cart).length;
        console.log(Object.keys(cart).length);
    });

    DisplayCart(cart);

    function DisplayCart(cart) {
        var cartString = "";
        cartString += '<div class="container-fluid"><h3 class=" text-center">Your cart</h3><ul class="list-group">';
        var cartIndex = 1;
        for (var x in cart) {
            var book_name = cart[x][1];
            var book_quantity = cart[x][0]
            cartString += '<li class="list-group-item list-group-item-action lead justify-content-between">'
            {#cartString += cartIndex;#}
            {#cartString += ": ";#}
            cartString += book_name + '</br>Qty:  <span class="badge badge-dark badge-pill py-auto">' + book_quantity + "</span></br></li>";
            cartIndex += 1;
        }
        cartString += "</ul><br><div class='row justify-content-md-center'><a class=\"lead btn btn-dark text-center mx-auto btn-block\" href='/checkout' role=\"button\" id='checkout'>Checkout</a></div></div>";
        document.getElementById("cart").setAttribute('data-content', cartString);
        $('a#cart').popover();
    }

    $('#items').val(JSON.stringify(cart));

    $(document).on('readystatechange', function () {
        console.log(cart);
        localStorage.setItem('cart', JSON.stringify(cart));
        document.getElementById("cart-count").innerHTML = Object.keys(cart).length;
        console.log(Object.keys(cart).length);
    });

</script>
</html>